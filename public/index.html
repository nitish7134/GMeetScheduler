<!doctype html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-giJF6kkoqNQ00vy+HMDP7azOuL0xtbfIcaT9wjKHr8RbDVddVHyTfAAsrekwKmP1" crossorigin="anonymous">
    <title>Google Meet Scheduler</title>
</head>

<body onload=GetScheduleList()>

    <div class="container">
        <nav class="navbar navbar-light bg-light">
            <div class="container-fluid">
                Google Meet Scheduler
            </div>
        </nav>
    </div>
    <div class="container" style="text-align: center; max-width: 500px;">
        <h1 class="display-4" style="font-size: 40px;">Schedule Google Meet</h1>

        <br>
        <form style="width: 100%;" id="MeetUrlForm">
            <div class="form-group">
                <label for="url">Meet Url</label>
                <input name="url" type="text" class="form-control" id="url"
                    placeholder="https://meet.google.com/abc-defg-hij" required>
            </div>
            <div class="form-group">
                <label for="startDate">Class Start Time</label>
                <input name="startDate" type="datetime-local" class="form-control" id="startDate" required>
            </div>
            <div class="form-group">
                <label for="endDate">Class End Time</label>
                <input name="endDate" type="datetime-local" class="form-control" id="endDate" required>
            </div>
            <div class="form-group mt-2">
                <button type="submit" class="btn btn-primary" onclick="postSchedule();">Post Bhenchod</button>
            </div>
        </form>
        <br>
    </div>

    <div class="container" style="text-align: center; max-width: 850px;">
        <h1 class="display-4" style="font-size: 40px;">Scheduled</h1>
        <div class="card-group" id="mainContainer">
            
        </div>
    </div>

    <script>

        function GetScheduleList() {
            $.ajax({
                url: "/list",
                type: "GET",
                success: function (response) {
                    var mainContainer = document.getElementById("mainContainer");
                    var output = [];
                    var schedule = response.meetSchedule;
                    for (var i = 0; i < schedule.length; i++) {
                        var item = (`
                            <div class="card text-white bg-dark m-1" style="max-width: 18rem;">
                                <div class="card-header">Id: ${i + 1}
                                </div>
                                <div class="card-body">
                                    <p class="card-title">Meet Url: ${schedule[i].meetLink}
                                    </p>
                                     <p class="card-title">Start Time: ${schedule[i].startTime}
                                    </p>
                                     <p class="card-title">EndTime: ${schedule[i].endTime}
                                    </p>
                                </div>
                            </div>`);
                        output.push(item);
                    }
                    mainContainer.innerHTML = output.join('');
                }, error: function (error) {
                    console.log("404");
                    console.log(error);
                }
            })
        }

        function postSchedule() {
            var rawData = $('#MeetUrlForm').serializeArray();
            console.log(rawData);
            var itemJSON = {};
            itemJSON.meetLink = rawData[0].value;
            itemJSON.startTime = rawData[1].value;
            itemJSON.endTime = rawData[2].value;
            console.log(itemJSON);
            $.ajax({
                url: "/postlink",
                type: "POST",
                data: itemJSON,
                credentials: 'same-origin',
                success: function (response) {
                    console.log("Posted item successfully");
                    console.log(response);
                    itemId = response._id;
                }, error(err) {
                    console.log(err);
                }
            });

        }

    </script>

    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.5.0.js"></script>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js"
        integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49"
        crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js"
        integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy"
        crossorigin="anonymous"></script>
</body>

</html>